#!/bin/bash

set -x

VERSION=1
SERVICE="Kopano-Api"

. /usr/share/univention-join/joinscripthelper.lib
. /usr/share/univention-appcenter/joinscripthelper.sh
. /usr/share/univention-lib/ldap.sh
. /usr/share/univention-lib/base.sh

joinscript_init
eval "$(ucr shell)"

CONFIG="$(joinscript_container_file /etc/univention/base.conf)"

ucs_addServiceToLocalhost "${SERVICE}" "$@"


a2enmod rewrite proxy proxy_http

cat <<-EOF >"/etc/apache2/ucs-sites.conf.d/kopano-api.conf"
#################################################################
# generated by Kopano-API app join script, do not edit manually #
#################################################################

# Kopano Rest API
ProxyPass /api/gc/ http://localhost:8039/api/gc/ retry=0
EOF

invoke-rc.d apache2 reload

joinscript_save_current_version
exit 0
