#!/bin/bash

set -x

VERSION=1
SERVICE="Kopano-Playground"

. /usr/share/univention-join/joinscripthelper.lib
. /usr/share/univention-appcenter/joinscripthelper.sh
. /usr/share/univention-lib/ldap.sh
. /usr/share/univention-lib/base.sh

joinscript_init
eval "$(ucr shell)"

CONFIG="$(joinscript_container_file /etc/univention/base.conf)"

ucs_addServiceToLocalhost "${SERVICE}" "$@"

a2enmod rewrite proxy proxy_http

cat <<-EOF >"/etc/apache2/ucs-sites.conf.d/kopano-playground.conf"
########################################################################
# generated by Kopano-Playground app join script, do not edit manually #
########################################################################

# Kopano Rest API
ProxyPass /oidc-playground/ http://localhost:8888/oidc-playground/ retry=0
ProxyPass /kapi-playground/ http://localhost:8888/kapi-playground/ retry=0
EOF

invoke-rc.d apache2 reload

joinscript_save_current_version
exit 0
